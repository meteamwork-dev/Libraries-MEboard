#include "MEBoard.h"
//Example06 ให้ตัวแปรจากการสื่อสาร RS485 สั่งเปิด-ปิดรีเลย์ แต่ละแชแนลด้วย Digitalinput

void setup() {
  pinmode(); //ประกาศขาที่จำเป็นต่อใช้งานของ MEBoard
  TimeSensor.setInterval(3000,ReadSensor);  //ความเร็วในการวนอ่านค่าเซ็นเซอร์ ตั้งค่าไว้ 3000 = 3Sec
  Serial.begin(19200); //เพื่อดูค่าใน Serial Monitor โดย baud-rate 19200
  slave.begin(9600); //สื่อสาร RS485 ช่องที่ 1 เลือก baud rate 9600   
  slave2.begin(9600); //สื่อสาร RS485 ช่องที่ 2 เลือก baud rate 9600
}

void ReadSensor(){
  ReadAI(); //อ่านค่า Analoginput และ NTC
/////////////forAIset///////////////////////

//////////////////////////////////////////
}

void loop() {
   TimeSensor.run(); //เปิดใช้งานฟังก์ชั่นเวลา
   ReadDI(); //อ่านค่า DI ทุกแชแนลของ MEBoard 
   modbusread(); //อ่านค่าจาก RS485
   Eeprom(); //จดจำค่าตัวแปรเมื่อบอร์ดไม่มีไฟเลี้ยง
   Register(); //ประกาศตำแหน่ง RS485 แต่ละตัวแปร

   if(ps1<0){ps1=0;} //ตั้งค่า 0-1 ให้ตัวแปรจากการสื่อสาร RS485 
   else if(ps1>1){ps1=1;}
   if(ps2<0){ps2=0;} //ตั้งค่า 0-1 ให้ตัวแปรจากการสื่อสาร RS485 
   else if(ps2>1){ps2=1;}
   if(ps3<0){ps3=0;} //ตั้งค่า 0-1 ให้ตัวแปรจากการสื่อสาร RS485 
   else if(ps3>1){ps3=1;}
   if(ps4<0){ps4=0;} //ตั้งค่า 0-1 ให้ตัวแปรจากการสื่อสาร RS485 
   else if(ps4>1){ps4=1;}
   if(ps5<0){ps5=0;} //ตั้งค่า 0-1 ให้ตัวแปรจากการสื่อสาร RS485 
   else if(ps5>1){ps5=1;}
   if(ps6<0){ps6=0;} //ตั้งค่า 0-1 ให้ตัวแปรจากการสื่อสาร RS485 
   else if(ps6>1){ps6=1;}
   if(ps7<0){ps7=0;} //ตั้งค่า 0-1 ให้ตัวแปรจากการสื่อสาร RS485 
   else if(ps7>1){ps7=1;}
   if(ps8<0){ps8=0;} //ตั้งค่า 0-1 ให้ตัวแปรจากการสื่อสาร RS485 
   else if(ps8>1){ps8=1;}
 /////////////programing here//////////////////
    DOut(1,ps1); //สั่งรีเลย์ Digitaloutput แชแนลที่1 ทำงาน
    DOut(2,ps2); //สั่งรีเลย์ Digitaloutput แชแนลที่2 ทำงาน
    DOut(3,ps3); //สั่งรีเลย์ Digitaloutput แชแนลที่3 ทำงาน
    DOut(4,ps4); //สั่งรีเลย์ Digitaloutput แชแนลที่4 ทำงาน
    DOut(5,ps5); //สั่งรีเลย์ Digitaloutput แชแนลที่5 ทำงาน
    DOut(6,ps6); //สั่งรีเลย์ Digitaloutput แชแนลที่6 ทำงาน
    DOut(7,ps7); //สั่งรีเลย์ Digitaloutput แชแนลที่7 ทำงาน
    DOut(8,ps8); //สั่งรีเลย์ Digitaloutput แชแนลที่8 ทำงาน
 /////////////////////////////////////////////  
}
